<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ AI –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
        }
    </style>
</head>
<body>
    <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ AI –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞</h1>
    
    <div class="test-section">
        <h2>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API</h2>
        <button onclick="testHealth()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Health Endpoint</button>
        <button onclick="testChatAPI()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Chat API</button>
        <div id="health-result" class="result"></div>
        <div id="chat-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤</h2>
        <button onclick="testStaticFiles()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã</button>
        <div id="static-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>3. –ü—Ä–æ–≤–µ—Ä–∫–∞ CORS</h2>
        <button onclick="testCORS()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å CORS</button>
        <div id="cors-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>4. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–∞—É–∑–µ—Ä–µ</h2>
        <div id="browser-info" class="result"></div>
    </div>

    <script>
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±—Ä–∞—É–∑–µ—Ä–µ
        document.getElementById('browser-info').innerHTML = `
            <strong>User Agent:</strong> ${navigator.userAgent}<br>
            <strong>URL:</strong> ${window.location.href}<br>
            <strong>Protocol:</strong> ${window.location.protocol}<br>
            <strong>Host:</strong> ${window.location.host}
        `;

        async function testHealth() {
            const resultDiv = document.getElementById('health-result');
            resultDiv.innerHTML = '–ü—Ä–æ–≤–µ—Ä—è–µ–º...';
            
            try {
                const response = await fetch('/health');
                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML = `<span class="success">‚úÖ Health endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç</span><br>–û—Ç–≤–µ—Ç: ${JSON.stringify(data)}`;
                } else {
                    resultDiv.innerHTML = `<span class="error">‚ùå Health endpoint –æ—à–∏–±–∫–∞: ${response.status}</span>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}</span>`;
            }
        }

        async function testChatAPI() {
            const resultDiv = document.getElementById('chat-result');
            resultDiv.innerHTML = '–ü—Ä–æ–≤–µ—Ä—è–µ–º...';
            
            try {
                const response = await fetch('/api/chat/message', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_id: 'diagnostic_test',
                        message: '–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ'
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML = `<span class="success">‚úÖ Chat API —Ä–∞–±–æ—Ç–∞–µ—Ç</span><br>–û—Ç–≤–µ—Ç: ${JSON.stringify(data).substring(0, 200)}...`;
                } else {
                    resultDiv.innerHTML = `<span class="error">‚ùå Chat API –æ—à–∏–±–∫–∞: ${response.status}</span>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå –û—à–∏–±–∫–∞ Chat API: ${error.message}</span>`;
            }
        }

        async function testStaticFiles() {
            const resultDiv = document.getElementById('static-result');
            resultDiv.innerHTML = '–ü—Ä–æ–≤–µ—Ä—è–µ–º...';
            
            const files = ['/main-interface.html', '/chat-widget.js', '/chat-widget.css'];
            let results = [];
            
            for (const file of files) {
                try {
                    const response = await fetch(file);
                    if (response.ok) {
                        results.push(`‚úÖ ${file} - OK`);
                    } else {
                        results.push(`‚ùå ${file} - ${response.status}`);
                    }
                } catch (error) {
                    results.push(`‚ùå ${file} - ${error.message}`);
                }
            }
            
            resultDiv.innerHTML = results.join('<br>');
        }

        async function testCORS() {
            const resultDiv = document.getElementById('cors-result');
            resultDiv.innerHTML = '–ü—Ä–æ–≤–µ—Ä—è–µ–º...';
            
            try {
                const response = await fetch('/api/chat/message', {
                    method: 'OPTIONS',
                    headers: {
                        'Access-Control-Request-Method': 'POST',
                        'Access-Control-Request-Headers': 'Content-Type'
                    }
                });
                
                if (response.ok) {
                    const corsHeaders = {
                        'Access-Control-Allow-Origin': response.headers.get('Access-Control-Allow-Origin'),
                        'Access-Control-Allow-Methods': response.headers.get('Access-Control-Allow-Methods'),
                        'Access-Control-Allow-Headers': response.headers.get('Access-Control-Allow-Headers')
                    };
                    resultDiv.innerHTML = `<span class="success">‚úÖ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ</span><br>–ó–∞–≥–æ–ª–æ–≤–∫–∏: ${JSON.stringify(corsHeaders)}`;
                } else {
                    resultDiv.innerHTML = `<span class="warning">‚ö†Ô∏è CORS preflight: ${response.status}</span>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå CORS –æ—à–∏–±–∫–∞: ${error.message}</span>`;
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ–º –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã
        window.onload = function() {
            testHealth();
            testStaticFiles();
        };
    </script>
</body>
</html>
